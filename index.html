<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
        <title>System process flow</title>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css" integrity="sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ" crossorigin="anonymous">
        <script src="https://code.jquery.com/jquery-3.1.1.slim.min.js" integrity="sha384-A7FZj7v+d/sdmMqp/nOQwliLvUsJfDHW+k9Omg/a/EheAdgtzNs3hpfag6Ed950n" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.min.js" integrity="sha384-DztdAPBWPRXSA/3eYEEUWrWCy7G5KFbe8fFjk5JAIxUYHKkDx6Qin1DkWx51bBrb" crossorigin="anonymous"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/js/bootstrap.min.js" integrity="sha384-vBWWzlZJ8ea9aCX4pEW3rVHjgjt7zpkNpZk+02D9phzyeVkE+jo0ieGizqPLForn" crossorigin="anonymous"></script>
    </head>
    <body>
        <div class="row">
            <div class="col-md-3">
                <div class="row">
                    <div class="col-md-12">
                        <h3>Job queue</h3>
                        <ul class="list-group" id="jobQueue">
                        </ul>   
                    </div>                 
                </div>
            </div>
            <div class="col-md-6">
                <div class="row">
                    <div class="col-md-12">
                        <h3>Ready queue</h3>
                        <ul class="list-group" id="readyQueue">
                        </ul> 
                    </div>
                </div>
                <div class="row my-2">
                    <div class="col-md-12">
                        <h3>Input</h3>
                        <div class="row my-2">
                            <div class="col-md-2">
                                <b>ID:</b>
                            </div>
                            <div class="col-md-10">
                                <input type="text" class="form-control" name="id" id="jobId" placeholder="Process ID goes here" />
                            </div>
                        </div>
                        <div class="row my-2">
                            <div class="col-md-2">
                                <b>I/O Devices:</b>
                            </div>
                            <div class="col-md-10">
                                <input type="checkbox" class="form-control" name="devices" id="jobDevices" placeholder="Process ID goes here" />
                            </div>
                        </div>
                        <div class="row my-2">
                            <div class="col-md-3">
                                <b>Running time:</b>
                            </div>
                            <div class="col-md-9">
                                <input type="number" class="form-control" name="time" id="jobTime" placeholder="Process ID goes here" />
                            </div>
                        </div>
                        <div class="row my-2">
                            <div class="col-md-12">
                                <button type="button" class="btn btn-success float-right" onclick="system.addProcess()">Add Process</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="row">
                    <div class="col-md-12">
                        <h3>CPU</h3>
                        <ul class="list-group">
                        </ul>                  
                    </div>     
                </div>
            </div>
        </div>
        <script type="text/javascript">
            // Global variables
            let system = {
                jobs: [], // List of jobs
                fromJobsToReadyTimeout: 2000, // Time in ms how much will take to move job from jobs to ready
                readyQueue: [], // List of ready jobs
                // Removes all child elements of a specific element
                removeChilds: (element) => {
                    while (element.firstChild) {
                        element.removeChild(element.firstChild);
                    }
                },
                // Create job queue
                updateJobQueue: () => {
                    let jobQueue = document.getElementById('jobQueue');
                    
                    // Removes all child elements
                    system.removeChilds(jobQueue);

                    for (let iJobs = 0; iJobs < system.jobs.length; iJobs++) {
                        let li = document.createElement('li');
                        li.className = (iJobs === system.jobs.length - 1) ? 'list-group-item active' : 'list-group-item';
                        let textNode = document.createTextNode(system.jobs[iJobs].text);
                        li.appendChild(textNode);
                        jobQueue.appendChild(li);
                    }
                },
                // Create ready queue
                updateReadyQueue: () => {
                    let readyQueue = document.getElementById('readyQueue');

                    // Removes all child elements
                    system.removeChilds(readyQueue);

                    for (let iJobs = 0; iJobs < system.readyQueue.length; iJobs++) {
                        let li = document.createElement('li');
                        li.className = (iJobs === system.jobs.length - 1) ? 'list-group-item active' : 'list-group-item';
                        let textNode = document.createTextNode(system.readyQueue[iJobs].text);
                        li.appendChild(textNode);
                        readyQueue.appendChild(li);
                    }
                },
                // Add process to queue
                addProcess: () => {
                    // Add process
                    system.jobs.unshift({
                        text: document.getElementById('jobId').value,
                        devices: document.getElementById('jobDevices').value,
                        time: document.getElementById('jobTime').value
                    });

                    // Clear fields
                    document.getElementById('jobId').value = '';
                    document.getElementById('jobDevices').value = '';
                    document.getElementById('jobTime').value = '';

                    // Update job queue
                    system.updateJobQueue();
                },
                // Move jobs from jobs queue to ready queue
                fromJobsToReady: () => {
                    // If there are any jobs
                    if (system.jobs.length > 0) {
                        // Push a job to the ready queue
                        system.readyQueue.push(system.jobs[system.jobs.length-1]);

                        // Remove job from the job queue
                        system.jobs.splice(-1, 1);
                    }

                    // Update ready queue
                    system.updateReadyQueue();

                    system.updateJobQueue();
                }
            };

            setInterval(system.fromJobsToReady, 2000);
        </script>
    </body>
</html>